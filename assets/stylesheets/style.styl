
@import 'index'
@import 'index@2x'

sprite-size(name, sprite = $index)
  width sprite[name][2]
  height sprite[name][3]
sprite-offset(name, sprite = $index)
  background-position sprite[name][0] sprite[name][1]
sprite-background(sprite, sizeContainer = null)
  background-image url(sprite['image'])
  if sizeContainer
    background-size sizeContainer['width'] sizeContainer['height']

retina_media_query = "(-webkit-min-device-pixel-ratio: 1.5),
  (min--moz-device-pixel-ratio: 1.5),
  (-o-min-device-pixel-ratio: 3/2),
  (min-device-pixel-ratio: 3/2)"

spritesheet-rules(
  sprite,
  prefix = "",
  applySize = null,
  withIconSizeRulesSuffix = "-size"
  )
  .{prefix}{join(", ." + prefix, sprite.names)}
    sprite-background(sprite, applySize)
  for spriteName in $index.names
    if withIconSizeRulesSuffix
      .{prefix}{spriteName},
      .{prefix}{spriteName}{withIconSizeRulesSuffix}
        sprite-size(spriteName, sprite)
    unless applySize
      .{prefix}{spriteName}
        sprite-offset(spriteName, applySize || sprite)

retina-spritesheet-rules(sprite, sprite2x, prefix = "")
  spritesheet-rules(sprite, prefix, null)
  @media retina_media_query
    spritesheet-rules(sprite2x, prefix, sprite, false)

retina-spritesheet-rules($index, $index_2x)

.demo-border
  border 1px dashed blue

.on-retina
  display none
@media retina_media_query
  .on-retina
    display block
  .not-on-retina
    display none
